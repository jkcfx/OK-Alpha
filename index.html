<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <title>OKX Boost Event Token Info Viewer</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
  <style>
    body { margin: 20px; font-family: Arial, sans-serif; }
    .header { display: flex; align-items: center; gap: 15px; margin-bottom: 15px; flex-wrap: wrap; justify-content: flex-start; }
    .promo-buttons { display: flex; gap: 10px; align-items: center; }
    .promo-buttons a { display: flex; align-items: center; gap: 5px; font-size: 0.95rem; text-decoration: none; color: #000; }
    .promo-buttons a i { font-size: 1.2rem; }
    .promo-buttons a:hover { color: #007bff; }
    .controls { display: flex; flex-wrap: wrap; gap: 10px; align-items: center; margin-bottom: 20px; }
    .table-container { max-height: 70vh; overflow-y: auto; }
    .last-updated { font-size: 0.9rem; color: #666; }
    .pagination { flex-wrap: nowrap; gap: 5px; }
    .page-size-select { width: 100px; }
  </style>
</head>
<body>
  <div class="header">
    <h2 class="mb-0">OKX Boost活动 代币一览</h2>
    <div class="promo-buttons">
      <a href="https://x.com/holdernevercry" target="_blank" title="点个关注">
        <span style="font-weight: bold;font-size: 1.5rem; color: #00bfff;">点个关注</span>
        <i class="bi bi-twitter"></i>
      </a>
     <a href="https://web3.okx.com/ul/joindex?ref=ETH16K" target="_blank" title="手续费8折" style="display: flex; align-items: center; gap: 5px;">
  <span style="font-weight: bold; font-size: 1.5rem;color: #00bfff;">手续费8折</span>
  <img src="/OK-Alpha/okx.png" alt="手续费8折" width="20" height="20">
</a>
 <!-- 邀请码文字 -->
  <div style="font-weight: bold; color: #00bfff;display: flex; flex-direction: row; align-items: center; gap: 10px; flex-wrap: wrap;">
    更多8折邀请码点击即用：
    <a href="https://web3.okx.com/ul/joindex?ref=BTC200K" target="_blank" title="BTC200K" style="display: flex; align-items: center; gap: 5px;">
  <span style="font-weight: bold;color: #00bfff;">BTC200K</span>
</a>
    <a href="https://web3.okx.com/ul/joindex?ref=ETH16K" target="_blank" title="ETH16K" style="display: flex; align-items: center; gap: 5px;">
  <span style="font-weight: bold;color: #00bfff;">ETH16K</span>
</a>
    <a href="https://web3.okx.com/ul/joindex?ref=CFX36U" target="_blank" title="CFX36U" style="display: flex; align-items: center; gap: 5px;">
  <span style="font-weight: bold;color: #00bfff;">CFX36U</span>
</a>
  </div>
</div>


    </div>
  </div>

  <div class="controls">
    <select id="chainFilter" class="form-select" style="width: 150px;">
      <option value="">全部链</option>
    </select>
    <input type="text" id="searchInput" class="form-control" placeholder="搜索 代币名或者合约" style="width: 250px;">
    <button id="searchBtn" class="btn btn-primary">搜索</button>
    <select id="pageSizeSelect" class="form-select page-size-select">
      <option value="10">10/页</option>
      <option value="15">15/页</option>
      <option value="20">20/页</option>
      <option value="25">25/页</option>
      <option value="50">50/页</option>
    </select>
    <span class="last-updated ms-3" id="lastUpdated"></span>

   
  </div>
  <div class="table-container">
    <table class="table table-striped table-bordered table-hover">
      <thead class="table-dark">
        <tr>
          <th>链名</th>
          <th>代币符号</th>
          <th>CA地址</th>
          <th>所属类别</th>
          <th>Last Modified</th>
        </tr>
      </thead>
      <tbody id="tableBody"></tbody>
    </table>
  </div>

  <nav>
    <ul class="pagination justify-content-center" id="pagination"></ul>
  </nav>
 <!-- 交易对测试 -->
<div style="margin-top: 40px; border-top: 2px solid #ddd; padding-top: 20px;">
  <h3 style="font-weight: bold; color: #007bff;">交易对倍率计算</h3>

  <div style="display: flex; gap: 20px; flex-wrap: wrap; align-items: flex-end;">
    <div>
      <label>链：</label>
      <select id="pairChain"></select>
    </div>

    <div>
      <label>币种 1：</label>
      <input list="tokenList1" id="pair1Token" placeholder="输入或选择币种">
      <datalist id="tokenList1"></datalist>
    </div>

    <div>
      <label>币种 2：</label>
      <input list="tokenList2" id="pair2Token" placeholder="输入或选择币种">
      <datalist id="tokenList2"></datalist>
    </div>

    <div>
      <button id="calcPair" style="padding: 6px 12px; font-weight: bold; color: #fff; background-color: #00bfff; border: none; border-radius: 4px; cursor: pointer;">
        计算倍率
      </button>
    </div>
  </div>

  <div id="pairResult" style="margin-top: 15px; font-weight: bold; color: #007bff;">
    倍率：
  </div>
</div>

<script>
  let allData = [];
  let filteredData = [];
  let pageSize = 15;
  let currentPage = 1;

  const chainFilter = document.getElementById("chainFilter");
  const searchInput = document.getElementById("searchInput");
  const searchBtn = document.getElementById("searchBtn");
  const tableBody = document.getElementById("tableBody");
  const pagination = document.getElementById("pagination");
  const lastUpdatedEl = document.getElementById("lastUpdated");
  const pageSizeSelect = document.getElementById("pageSizeSelect");

  const pairChain = document.getElementById("pairChain");
  const tokenList1 = document.getElementById("tokenList1");
  const tokenList2 = document.getElementById("tokenList2");

  async function loadData() {
    try {
      const res = await fetch("data.json?ts=" + new Date().getTime());
      const json = await res.json();
      allData = json.tokens || [];

      // 更新时间
      if (json.lastUpdated) {
        const date = new Date(json.lastUpdated * 1000);
        lastUpdatedEl.textContent = "更新时间: " + date.toLocaleString();
      }

      // Token 列表下拉
      initFilters(allData);
      applyFilters();

      // 交易对测试链下拉
      const chains = [...new Set(allData.map(item => item.chainName))];
      pairChain.innerHTML = "";
      chains.forEach(chain => {
        const opt = document.createElement("option");
        opt.value = chain;
        opt.textContent = chain;
        pairChain.appendChild(opt);
      });

      // 默认填充 datalist
      updateTokenLists();

    } catch (err) {
      console.error("加载数据失败:", err);
    }
  }

  function initFilters(data) {
    const chains = [...new Set(data.map(item => item.chainName))];
    chainFilter.innerHTML = '<option value="">全部链</option>';
    chains.forEach(chain => {
      const opt = document.createElement("option");
      opt.value = chain;
      opt.textContent = chain;
      chainFilter.appendChild(opt);
    });
  }

  function renderTable(data, page) {
    tableBody.innerHTML = "";
    const start = (page - 1) * pageSize;
    const end = start + pageSize;
    const pageData = data.slice(start, end);
    pageData.forEach(item => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${item.chainName}</td>
        <td>${item.symbol}</td>
        <td>${item.tokenAddress}</td>
        <td>${item.tag || ""}</td>
        <td>${new Date(item.lastModifiedTime * 1000).toLocaleString()}</td>
      `;
      tableBody.appendChild(tr);
    });
    renderPagination(data.length, page);
  }

  function renderPagination(totalItems, page) {
    pagination.innerHTML = "";
    const totalPages = Math.ceil(totalItems / pageSize);
    if (totalPages <= 1) return;

    const prevLi = document.createElement("li");
    prevLi.className = "page-item" + (page === 1 ? " disabled" : "");
    const prevBtn = document.createElement("button");
    prevBtn.className = "page-link";
    prevBtn.textContent = "«";
    prevBtn.onclick = () => { if (page > 1) { currentPage--; renderTable(filteredData, currentPage); } };
    prevLi.appendChild(prevBtn);
    pagination.appendChild(prevLi);

    const currLi = document.createElement("li");
    currLi.className = "page-item active";
    const currBtn = document.createElement("button");
    currBtn.className = "page-link";
    currBtn.textContent = `${page} / ${totalPages}`;
    currBtn.disabled = true;
    currLi.appendChild(currBtn);
    pagination.appendChild(currLi);

    const nextLi = document.createElement("li");
    nextLi.className = "page-item" + (page === totalPages ? " disabled" : "");
    const nextBtn = document.createElement("button");
    nextBtn.className = "page-link";
    nextBtn.textContent = "»";
    nextBtn.onclick = () => { if (page < totalPages) { currentPage++; renderTable(filteredData, currentPage); } };
    nextLi.appendChild(nextBtn);
    pagination.appendChild(nextLi);
  }

  function applyFilters() {
    const chain = chainFilter.value.trim();
    const keyword = searchInput.value.trim().toLowerCase();
    filteredData = allData.filter(item => {
      const matchChain = !chain || item.chainName === chain;
      const matchKeyword = !keyword || item.symbol.toLowerCase().includes(keyword) || item.tokenAddress.toLowerCase().includes(keyword);
      return matchChain && matchKeyword;
    });
    currentPage = 1;
    renderTable(filteredData, currentPage);
  }

  searchBtn.addEventListener("click", applyFilters);
  chainFilter.addEventListener("change", applyFilters);
  searchInput.addEventListener("keypress", (e) => { if (e.key === "Enter") applyFilters(); });
  pageSizeSelect.addEventListener("change", () => {
    pageSize = parseInt(pageSizeSelect.value);
    currentPage = 1;
    renderTable(filteredData, currentPage);
  });

  // 更新 datalist
  // 更新 datalist
function updateTokenLists() {
  const chain = pairChain.value;
  const tokens = allData.filter(item => item.chainName === chain).map(item => item.symbol);

  function bindInputFilter(inputId, datalistEl) {
    const inputEl = document.getElementById(inputId);
    inputEl.addEventListener("input", () => {
      const keyword = inputEl.value.trim().toLowerCase();
      datalistEl.innerHTML = "";
      let matched;
      if (!keyword) {
        // 没输入时显示全部
        matched = tokens;
      } else {
        // 严格前缀匹配
        matched = tokens.filter(t => t.toLowerCase().startsWith(keyword));
      }
      matched.forEach(t => {
        const opt = document.createElement("option");
        opt.value = t;
        datalistEl.appendChild(opt);
      });
    });
    // 初始填充
    inputEl.dispatchEvent(new Event("input"));
  }

  bindInputFilter("pair1Token", tokenList1);
  bindInputFilter("pair2Token", tokenList2);
}


  pairChain.addEventListener("change", updateTokenLists);

  // 分类函数
  const getCategory = (token, chain) => {
    const found = allData.find(item => item.chainName === chain && item.symbol.toLowerCase() === token.toLowerCase());
    return found ? (found.tag || "other") : "other";
  };

  // 计算倍率
  document.getElementById("calcPair").addEventListener("click", () => {
    const chain = pairChain.value;
    const token1 = document.getElementById("pair1Token").value.trim();
    const token2 = document.getElementById("pair2Token").value.trim();

    if (!token1 || !token2) {
      document.getElementById("pairResult").textContent = "请填写两个币种";
      return;
    }

    const cat1 = getCategory(token1, chain);
    const cat2 = getCategory(token2, chain);

    let ratio = "不计入";
    if ((cat1 === "Group1" && cat2 === "Group2") || (cat1 === "Group2" && cat2 === "Group1")) {
      ratio = "0.25 倍";
    } else if (cat1 === "Group2" && cat2 === "Group2") {
      ratio = "0.25 倍";
    } else if ((cat1 === "Group1" || cat1 === "Group2") && cat2 === "other" || (cat2 === "Group1" || cat2 === "Group2") && cat1 === "other") {
      ratio = "1 倍";
    } else if (cat1 === "Group1" && cat2 === "Group1") {
      ratio = "不计入";
    } else if (cat1 === "other" && cat2 === "other") {
      ratio = "不计入";
    }

    document.getElementById("pairResult").textContent = `倍率：${ratio}`;
  });

  loadData();
</script>
