<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <title>Token Info Viewer</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
  <style>
    body { margin: 20px; font-family: Arial, sans-serif; }
    .header { display: flex; align-items: center; gap: 15px; margin-bottom: 15px; flex-wrap: wrap; justify-content: flex-start; }
    .promo-buttons { display: flex; gap: 10px; align-items: center; }
    .promo-buttons a { display: flex; align-items: center; gap: 5px; font-size: 0.95rem; text-decoration: none; color: #000; }
    .promo-buttons a i { font-size: 1.2rem; }
    .promo-buttons a:hover { color: #007bff; }
    .controls { display: flex; flex-wrap: wrap; gap: 10px; align-items: center; margin-bottom: 20px; }
    .table-container { max-height: 70vh; overflow-y: auto; }
    .last-updated { font-size: 0.9rem; color: #666; }
    .pagination { flex-wrap: nowrap; gap: 5px; }
    .page-size-select { width: 100px; }
  </style>
</head>
<body>
  <div class="header">
    <h2 class="mb-0">Token 列表</h2>
    <div class="promo-buttons">
      <a href="https://x.com/你的账号" target="_blank" title="关注我的X账号">
        <span>关注X</span>
        <i class="bi bi-twitter"></i>
      </a>
      <a href="https://你的推广链接" target="_blank" title="推广链接">
        <span>推广链接</span>
        <i class="bi bi-share-fill"></i>
      </a>
    </div>
  </div>

  <div class="controls">
    <select id="chainFilter" class="form-select" style="width: 150px;">
      <option value="">全部链</option>
    </select>
    <input type="text" id="searchInput" class="form-control" placeholder="搜索 代币名或者合约" style="width: 250px;">
    <button id="searchBtn" class="btn btn-primary">搜索</button>
    <select id="pageSizeSelect" class="form-select page-size-select">
      <option value="10">10/页</option>
      <option value="15">15/页</option>
      <option value="20">20/页</option>
      <option value="25">25/页</option>
      <option value="50">50/页</option>
    </select>
    <span class="last-updated ms-3" id="lastUpdated"></span>

   
  </div>
  <div class="table-container">
    <table class="table table-striped table-bordered table-hover">
      <thead class="table-dark">
        <tr>
          <th>链名</th>
          <th>代币符号</th>
          <th>CA地址</th>
          <th>所属类别</th>
          <th>Last Modified</th>
        </tr>
      </thead>
      <tbody id="tableBody"></tbody>
    </table>
  </div>

  <nav>
    <ul class="pagination justify-content-center" id="pagination"></ul>
  </nav>

  <script>
    let pageSize = 15;
    let currentPage = 1;
    let allData = [];
    let filteredData = [];

    const chainFilter = document.getElementById("chainFilter");
    const searchInput = document.getElementById("searchInput");
    const searchBtn = document.getElementById("searchBtn");
    const tableBody = document.getElementById("tableBody");
    const pagination = document.getElementById("pagination");
    const lastUpdatedEl = document.getElementById("lastUpdated");
    const pageSizeSelect = document.getElementById("pageSizeSelect");

    function initFilters(data) {
      const chains = [...new Set(data.map(item => item.chainName))];
      chainFilter.innerHTML = '<option value="">全部链</option>';
      chains.forEach(chain => {
        const opt = document.createElement("option");
        opt.value = chain;
        opt.textContent = chain;
        chainFilter.appendChild(opt);
      });
    }

    function renderTable(data, page) {
      tableBody.innerHTML = "";
      const start = (page - 1) * pageSize;
      const end = start + pageSize;
      const pageData = data.slice(start, end);

      pageData.forEach(item => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${item.chainName}</td>
          <td>${item.symbol}</td>
          <td>${item.tokenAddress}</td>
          <td>${item.tag || ""}</td>
          <td>${new Date(item.lastModifiedTime * 1000).toLocaleString()}</td>
        `;
        tableBody.appendChild(tr);
      });

      renderPagination(data.length, page);
    }

    function renderPagination(totalItems, page) {
      pagination.innerHTML = "";
      const totalPages = Math.ceil(totalItems / pageSize);
      if(totalPages <= 1) return;

      // 上一页
      const prevLi = document.createElement("li");
      prevLi.className = "page-item" + (page === 1 ? " disabled" : "");
      const prevBtn = document.createElement("button");
      prevBtn.className = "page-link";
      prevBtn.textContent = "«";
      prevBtn.onclick = () => { if(page>1){currentPage--; renderTable(filteredData,currentPage);} };
      prevLi.appendChild(prevBtn);
      pagination.appendChild(prevLi);

      // 当前页号显示
      const currLi = document.createElement("li");
      currLi.className = "page-item active";
      const currBtn = document.createElement("button");
      currBtn.className = "page-link";
      currBtn.textContent = `${page} / ${totalPages}`;
      currBtn.disabled = true;
      currLi.appendChild(currBtn);
      pagination.appendChild(currLi);

      // 下一页
      const nextLi = document.createElement("li");
      nextLi.className = "page-item" + (page === totalPages ? " disabled" : "");
      const nextBtn = document.createElement("button");
      nextBtn.className = "page-link";
      nextBtn.textContent = "»";
      nextBtn.onclick = () => { if(page<totalPages){currentPage++; renderTable(filteredData,currentPage);} };
      nextLi.appendChild(nextBtn);
      pagination.appendChild(nextLi);
    }

    function applyFilters() {
      const chain = chainFilter.value.trim();
      const keyword = searchInput.value.trim().toLowerCase();

      filteredData = allData.filter(item => {
        const matchChain = !chain || item.chainName === chain;
        const matchKeyword = !keyword ||
          item.symbol.toLowerCase().includes(keyword) ||
          item.tokenAddress.toLowerCase().includes(keyword);
        return matchChain && matchKeyword;
      });

      currentPage = 1;
      renderTable(filteredData, currentPage);
    }

    searchBtn.addEventListener("click", applyFilters);
    chainFilter.addEventListener("change", applyFilters);
    searchInput.addEventListener("keypress", (e) => { if(e.key==="Enter") applyFilters(); });
    pageSizeSelect.addEventListener("change", () => {
      pageSize = parseInt(pageSizeSelect.value);
      currentPage = 1;
      renderTable(filteredData, currentPage);
    });

    async function loadData() {
      try {
        const res = await fetch("data.json?ts=" + new Date().getTime()); // 防缓存
        const json = await res.json();
        allData = json.tokens || [];
        if(json.lastUpdated){
          const date = new Date(json.lastUpdated * 1000);
          lastUpdatedEl.textContent = "更新时间: " + date.toLocaleString();
        }
        initFilters(allData);
        applyFilters();
      } catch (err) {
        console.error("加载数据失败:", err);
      }
    }

    loadData();
  </script>
</body>
</html>
